class PostLikeToggle(RedirectView):
    def get_redirect_url(self, *args, **kwargs):
        slug = self.kwargs.get('slug')
        obj = get_object_or_404(Post, slug=slug)
        url_ = obj.get_absolute_url()
        user = self.request.user
        if user.is_authenticated:
            if user in obj.likes.all():
                obj.likes.remove(user)
            else:
                obj.likes.add(user)
        return url_


class PostLikeAPIToggle(APIView):
    """
    View to list all users in the system.

    * Requires token authentication.
    * Only admin users are able to access this view.
    """
    authentication_classes = (authentication.SessionAuthentication,)
    permission_classes = (permissions.IsAuthenticated,)

    def get(self, request, slug=None, format=None):
        # slug = self.kwargs.get('slug')
        obj = get_object_or_404(Post, slug=slug)
        url_ = obj.get_absolute_url()
        user = self.request.user
        updated = False
        liked = False
        if user.is_authenticated:
            if user in obj.likes.all():
                liked = False
                obj.likes.remove(user)
            else:
                liked = True
                obj.likes.add(user)
                updated = True
        data = {
            "updated": updated,
            "liked": liked
        }

        return Response(data)


    <a href="{{ post.get_like_url }}" data-likes="{{ post.likes.count }}"
        class="like-btn btn btn-success" data-href="{{ post.get_api_like_url }}">
            Like
        <span>{{ post.likes.count }}</span>
    </a>

    <a href="{{ instance.get_like_url }}" data-likes="{{ instance.likes.count }}"
     class="like-btn btn btn-success" data-href="{{ instance.get_api_like_url }}">
        Like
        <span>{{ instance.likes.count }}</span>
    </a>

<script>
$(document).ready(function(){
    function updateText(btn, newCount, verb) {
        btn.text(newCount + "" + verb)
    }

    $(".like-btn").click(function (e) {
        e.preventDefault()
        const this_ = $(this)
        const likeUrl = this_.attr("data-href")
        const likeCount = parseInt(this_.attr("data-likes")) | 0
        const addLike = likeCount + 1
        const removeLike = likeCount - 1
        if (likeUrl){
            $.ajax({
                url: likeUrl,
                method: "GET",
                data: {},
                success: function (data) {
                    console.log(data)
                    var newLikes;
                    if (data.liked) {
                        updateText(this_, addLike, "unlike")
                    } else {
                        newLikes = likeCount - 1
                        updateText(this_, removeLike, "like")
                    }
                }, errors: function (error) {
                    console.log(error)
                    console.log("error")
                }
            })
        }
    })
})

</script>